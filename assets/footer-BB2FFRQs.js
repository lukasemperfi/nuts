(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const w="";console.log("Supabase клиент инициализирован.");class F{getAllProducts=async(t={})=>{console.log("from API:",t);const{flavor:r=[],weight:s=[],sort:o=null}=t;let n=w.from("products").select(`
        *,
        product_images (*),
        product_flavors!inner (
          flavor_id,
          flavors!inner (*)
        ),
        packaging_types (*),
        product_statuses (*)
      `).limit(6);r.length>0&&(n=n.in("product_flavors.flavors.value",r)),s.length>0&&(n=n.in("weight",s)),(o==="asc"||o==="desc")&&(n=n.order("price",{ascending:o==="asc"}));const{data:i,error:c}=await n;return c?(console.error("Ошибка при получении продуктов:",c.message),[]):i};getProductById=async t=>{if(!t||isNaN(t))return null;const{data:r,error:s}=await w.from("products").select(`
        *,
        product_images (
          id,
          image_path_png,
          image_path_webp,
          is_main,
          sort_order
        ),
        product_flavors (
          flavor_id,
          flavors (
            id,
            name,
            value
          )
        ),
        packaging_types (
          id,
          name
        ),
        product_statuses (
          id,
          name
        )
      `).eq("id",t).single();return s?(s.code==="PGRST116"||console.error("Ошибка при получении продукта:",s),null):r}}const _=new F,m={IDLE:"idle",LOADING:"loading",SUCCEEDED:"succeeded",FAILED:"failed"},A={items:[],status:m.IDLE,error:null,lastFetched:null},P={name:"products",initialState:A,reducers:{setLoading:e=>({...e,status:m.LOADING,error:null}),setProducts:(e,t)=>({...e,items:t.payload,status:m.SUCCEEDED,error:null,lastFetched:new Date().toISOString()}),setError:(e,t)=>({...e,status:m.FAILED,error:t.payload}),clearError:e=>({...e,error:null}),reset:()=>A}};async function T(e){if(l.getState().products.status!==m.LOADING){l.dispatch({type:"products/setLoading"});try{const r={...e,weight:e?.weight?.map(o=>Number(o))||[]};console.log("Fetching products",r);const s=await _.getAllProducts(r);return l.dispatch({type:"products/setProducts",payload:s}),s}catch(r){const s=r.message||"Unknown error occurred";throw l.dispatch({type:"products/setError",payload:s}),r}}}const O={name:"productFilters",initialState:{filters:{weight:[],flavor:[],sort:null},isInitialized:!1},reducers:{setFilters:(e,t)=>({...e,filters:{...e.filters,...t.payload}}),setInitialized:(e,t)=>({...e,isInitialized:t.payload}),resetFilters:e=>({...e,filters:{weight:[],flavor:[],sort:null}})}},U={setFilters:e=>({type:"productFilters/setFilters",payload:e}),setInitialized:e=>({type:"productFilters/setInitialized",payload:e}),resetFilters:()=>({type:"productFilters/resetFilters"})},h={IDLE:"idle",LOADING:"loading",SUCCEEDED:"succeeded",FAILED:"failed"},L={item:null,status:h.IDLE,error:null,lastFetched:null,currentId:null},C={name:"product",initialState:L,reducers:{setLoading:e=>({...e,status:h.LOADING,error:null}),setProduct:(e,t)=>({...e,item:t.payload,status:h.SUCCEEDED,error:null,lastFetched:new Date().toISOString(),currentId:t.payload?.id||null}),setError:(e,t)=>({...e,status:h.FAILED,error:t.payload,item:null}),clearError:e=>({...e,error:null}),reset:()=>L}};async function M(e){const t=l.getState().product;if(!(t.status===h.LOADING&&t.currentId===e)){if(t.status===h.SUCCEEDED&&t.currentId===e&&t.item)return t.item;l.dispatch({type:"product/setLoading"});try{const r=await _.getProductById(e);return r?(l.dispatch({type:"product/setProduct",payload:r}),r):(l.dispatch({type:"product/setError",payload:"Продукт не найден"}),null)}catch(r){const s=r.message||"Не удалось загрузить продукт";throw l.dispatch({type:"product/setError",payload:s}),r}}}class q{constructor(){this.state={},this.reducers={},this.listeners=new Map,this.persistConfig={},this.storageKey="app_store"}registerSlice(t,r={persist:!1,fields:null}){const o=this.loadFullStoreFromStorage()[t.name];this.state[t.name]=o||t.initialState,this.reducers[t.name]=t.reducers,this.persistConfig[t.name]=r}getState(){return this.state}dispatch(t){const[r,s]=t.type.split("/");if(!r||!s){console.error(`Некорректный action.type: ${t.type}. Ожидается 'slice/reducer'.`);return}const o=this.reducers[r];if(!o||!o[s]){console.warn(`Не найден редьюсер ${s} в слайсе ${r}.`);return}const n=o[s],i=this.state[r],c=n(i,t);this.state[r]=c,this.saveSliceToFullStorage(r,c),this.notify(r,c)}subscribe(t,r){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(r);const s=this.state[t];s!==void 0&&r(s)}unsubscribe(t,r){this.listeners.has(t)&&(this.listeners.get(t).delete(r),this.listeners.get(t).size===0&&this.listeners.delete(t),console.log(`Отписана функция от события: ${t}`))}notify(t,r){if(!this.listeners.has(t)){console.log(`Нет подписчиков на событие: ${t}`);return}this.listeners.get(t).forEach(s=>{s(r)})}loadFullStoreFromStorage(){const t=localStorage.getItem(this.storageKey);if(!t)return{};try{return JSON.parse(t)}catch{return{}}}saveSliceToFullStorage(t,r){const s=this.persistConfig[t];if(!s?.persist)return;const o=this.loadFullStoreFromStorage();let n=r;Array.isArray(s.fields)&&(n={},s.fields.forEach(i=>{r.hasOwnProperty(i)&&(n[i]=r[i])})),o[t]=n,localStorage.setItem(this.storageKey,JSON.stringify(o))}}const l=new q;l.registerSlice(P,{persist:!0});l.registerSlice(O,{persist:!0});l.registerSlice(C);const $=({selector:e,onChange:t,defaultValues:r=[]})=>{const s=document.querySelector(e),o=s.dataset.multiple==="true",n=s.querySelector(".dropdown__button"),i=s.querySelector(".dropdown__selected"),c=s.querySelectorAll(".dropdown__option"),g=s.querySelector(".dropdown__dropdown");let u=[];const S=()=>{const a=n.getAttribute("aria-expanded")==="true";n.setAttribute("aria-expanded",String(!a))},p=()=>{n.setAttribute("aria-expanded","false")},f=()=>{const a=u.map(d=>d.querySelector(".dropdown__label").textContent.trim());i.textContent=a.length>0?a.join(", "):i.dataset.placeholder||"Select..."},v=a=>{const d=a.getAttribute("aria-selected")==="true";o?d?(a.setAttribute("aria-selected","false"),u=u.filter(y=>y!==a)):(a.setAttribute("aria-selected","true"),u.push(a)):(c.forEach(y=>y.removeAttribute("aria-selected")),a.setAttribute("aria-selected","true"),u=[a],p()),f()};return n.addEventListener("click",S),g.addEventListener("click",a=>{const d=a.target.closest(".dropdown__option");if(d&&(a.stopPropagation(),v(d),t)){const y=d.dataset.value,D=s.dataset.name;t(D,y)}}),document.addEventListener("click",a=>{s.contains(a.target)||p()}),i.dataset.placeholder=i.textContent.trim(),r.length>0&&(c.forEach(a=>{const d=a.dataset.value;r.includes(d)&&(a.setAttribute("aria-selected","true"),u.push(a))}),f()),{reset:()=>{c.forEach(a=>a.removeAttribute("aria-selected")),u=[],f()}}};function I(e=".nav-menu__link",t="active"){const r=o=>o?"/"+o.replace(/^\/+|\/+$/g,""):"/",s=r(window.location.pathname);document.querySelectorAll(e).forEach(o=>{const n=o.getAttribute("href");if(!n||n.startsWith("#"))return;r(n)===s?(o.classList.add(t),o.style.pointerEvents="none",o.style.cursor="default",o.setAttribute("aria-disabled","true")):(o.classList.remove(t),o.style.pointerEvents="",o.style.cursor="",o.removeAttribute("aria-disabled"))})}function G(){x(),z(),I(".nav-menu__link"),document.querySelectorAll(".auth a").forEach(t=>{const r=t.getAttribute("href").replace(/\/+$/,""),s=window.location.pathname.replace(/\/+$/,"");console.log(r,s),r===s&&(t.classList.add("active"),t.addEventListener("click",o=>o.preventDefault()))})}function x(){const e=document.querySelector(".middle-header__burger-btn"),t=document.querySelector(".mobile-menu"),r=document.querySelector(".mobile-menu__close");!e||!t||(e.addEventListener("click",function(){const s=t.classList.toggle("is-open");e.setAttribute("aria-expanded",s?"true":"false"),document.body.style.overflow=s?"hidden":"auto"}),r&&r.addEventListener("click",()=>{t.classList.remove("is-open"),e.setAttribute("aria-expanded","false"),document.body.style.overflow="auto"}))}function z(){const e=document.querySelector(".mobile-menu"),t=document.querySelector(".middle-header__burger-btn");!e||!t||window.addEventListener("resize",function(){e.classList.contains("is-open")&&(e.classList.remove("is-open"),t.setAttribute("aria-expanded","false"),document.body.style.overflow="auto")})}function N(e=".lazy",t={}){const s={...{root:null,rootMargin:"0px",threshold:.01},...t},o=document.querySelectorAll(e);if("IntersectionObserver"in window){let n=o.length;const i=(g,u)=>{g.forEach(S=>{if(S.isIntersecting){const p=S.target;b(p,e);const f=p.closest("picture");f&&f.querySelectorAll("source[data-srcset]").forEach(E=>b(E,e)),u.unobserve(p),n--,n===0&&u.disconnect()}})},c=new IntersectionObserver(i,s);o.forEach(g=>{c.observe(g)})}else o.forEach(n=>b(n,e))}function b(e,t){const r=e.tagName.toLowerCase()==="iframe",s="/nuts/";e.dataset.src&&(e.src=r?e.dataset.src:s+e.dataset.src.replace(/^\/+/,""),delete e.dataset.src),e.dataset.srcset&&(e.srcset=r?e.dataset.srcset:s+e.dataset.srcset.replace(/^\/+/,""),delete e.dataset.srcset),e.classList.contains(t.replace(".",""))&&e.classList.remove(t.replace(".",""))}const B=()=>{I(".nav-menu__link")};export{m as P,G as a,B as b,T as c,M as f,$ as i,N as l,U as p,l as s};
