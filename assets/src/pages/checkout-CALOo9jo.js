import{s as f,d as C,i as S,C as A,Q as D,f as g,a as w,b as O,l as R,j as q}from"../../footer-BnmDAafM.js";import{c as M,r as N}from"../../index-ni-So6HJ.js";import{J as U,R as h,a as I,E as T,F as x,c as P,r as v}from"../../rules-8moWvT5A.js";import{o as V}from"../../order-BQ6WNSXK.js";import{i as Y}from"../../breadcrumbs-Bdl_gLzY.js";const n={FORM:"#checkout-form",FULL_NAME:"#checkout-form-full-name",EMAIL:"#checkout-form-email",PHONE:"#checkout-form-phone",COUNTRY:"#checkout-form-country",REGION:"#checkout-form-region",CITY:"#checkout-form-city",ADDRESS:"#checkout-form-address"},L={[n.FULL_NAME]:[h,x],[n.EMAIL]:[h,T],[n.PHONE]:[h,I]};function H(){const e={errorFieldCssClass:"form-field__input_error",errorLabelCssClass:"form-field__error",focusInvalidField:!0,lockForm:!0,validateBeforeSubmitting:!0,errorFieldStyle:{},errorLabelStyle:{}},o=new U(n.FORM,e);for(const t in L)o.addField(t,L[t]);return o}const B=(e,o)=>{const t=e.delivery_method;if(t==="nova_poshta"){const c={country:e.country,region:e.region,city:e.city};delete e.country,delete e.region,delete e.city,e.nova_poshta=c}else if(t==="courier"){const c={address:e.address};delete e.address,e.courier=c}return delete e.dalivery_method,!e.delivery_method&&t&&(e.delivery_method=t),{...e,products:o}},G=()=>{const e=P(),o=H().onSuccess(async a=>{a.preventDefault();const i=f.getState().cart.items,s=f.getState().cart.products,u=document.querySelector(n.FORM),_=new FormData(u),d=Object.fromEntries(_.entries()),l=B(d,i);l.total_amount=t(i,s),e.show();try{await V.createOrder(l),f.dispatch({type:"cart/clearCart"}),v(`${C}thank-you/`,0,!0)}catch(p){console.error("Order error:",p)}finally{e.hide()}});function t(a,i){const s=new Map;a.forEach(d=>{s.set(Number(d.productId),d.quantity)});const u=s||new Map,_=1;return i.reduce((d,l)=>{const p=u.get(l.id)||_;return d+p*l.price},0)}const c=S({selector:".checkout-form__region-dropdown",disabled:!0}),y=S({selector:".checkout-form__country-dropdown",items:M,onChange:(a,i)=>{$(i,c,N)}});Q(o,{countryDropdown:y,regionDropdown:c})};function Q(e,o){const{countryDropdown:t,regionDropdown:c}=o,y=document.getElementById("checkout-form"),a=y.querySelectorAll('input[name="delivery_method"]'),i=y.querySelector(".nova_poshta__fields"),s=y.querySelector(".courier__fields"),u=(r,F)=>{if(!r)return;r.querySelectorAll("input, select, textarea").forEach(E=>{E.disabled=F})},_=r=>{if(!r)return;r.querySelectorAll(".dropdown_select").forEach(m=>{const E=m.querySelector(".dropdown__selected"),k=m.querySelector('.dropdown__option[aria-selected="true"]');E.innerHTML=E.dataset.placeholder,k&&k.removeAttribute("aria-selected")})},d=r=>{if(!r)return;r.querySelectorAll("input, select, textarea").forEach(m=>{m.type==="checkbox"||m.type==="radio"?m.checked=!1:m.value=""}),_(r)};let l="";const p=r=>{t.reset(),c.reset(),c.setDisabled(!0),d(i),d(s),l==="nova_poshta"&&z(e),l==="courier"&&K(e),u(i,!0),u(s,!0),i.classList.add("hidden"),s.classList.add("hidden"),r==="nova_poshta"&&(i.classList.remove("hidden"),u(i,!1),j(e)),r==="courier"&&(s.classList.remove("hidden"),u(s,!1),J(e)),l=r};a.forEach(r=>{r.addEventListener("change",()=>p(r.value))});const b=document.querySelector('input[name="delivery_method"]:checked');b&&p(b.value)}function $(e,o,t,c,y){const a=t[e]||[];o.updateOptions(a),a.length>0?o.setDisabled(!1):o.setDisabled(!0)}function j(e){[[n.COUNTRY,[h]],[n.REGION,[h]],[n.CITY,[h]]].forEach(([t,c])=>{e.addField(t,c)})}function z(e){[n.COUNTRY,n.REGION,n.CITY].forEach(t=>{e.removeField(t)})}function J(e){e.addField(n.ADDRESS,[h])}function K(e){e.removeField(n.ADDRESS)}const W=[{key:"productName",label:"Товар",type:"text",width:"max-content",align:"left"},{key:"quantity",label:"Кол-во",type:"component",render:e=>new D(e.quantity,e.id).element,width:"max-content"},{key:"price",label:"Цена за товар",type:"currency",width:"max-content",render:e=>g(e.price,"грн.")},{key:"total",label:"Итоговая стоимость",type:"currency",width:"max-content",render:e=>g(e.total,"грн.")}],X={leftAction:null,rightGroup:[{type:"total",text:"Всего",amountKey:"totalAmount",unit:"грн."}]},Z=async()=>{const e=document.querySelector(".checkout-section__cart");A({container:e,columns:W,footer:X}),G()},ee=()=>{Y(".checkout-page-breadcrumbs__container","breadcrumbs_color_muted")};document.addEventListener("DOMContentLoaded",async()=>{await te(),f.subscribe("cart",()=>{f.getState().cart.items.length===0&&v(`${C}`,0,!0)}),f.subscribe("auth",e=>{e.isAuth||v(`${C}`,0,!0)}),S({selector:".top-header__lang"}),w(),ee(),Z(),O(),R(".lazy",{rootMargin:"200px 0px"})});async function te(){const e=await q(),o=f.getState().cart.items.length===0;if(!e||o){v(`${C}`,0,!0);return}const t=document.querySelector("#private-content");t&&t.removeAttribute("id")}
